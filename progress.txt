# site-crownandcompass Progress

---

## Session — Feb 27, 2026 (continued)

**Completed:**
- Fixed Counterfeit Gods Amazon link + cover (ASIN B09V1ZXS7R)
- Fixed Man in the Mirror Amazon link + cover (ASIN 0310331757)
- Increased font sizes site-wide (body 17px → 18px, h1/h2/h3 bumped)
- Books page: 2-column grid, larger book titles/descriptions/authors, bigger covers
- Join page: chapter locations map (Leaflet.js, CartoDB dark tiles, 4 amber markers)

**Files Changed:**
- `src/data/books.json` — corrected ASINs and affiliate links for Counterfeit Gods + Man in the Mirror
- `src/styles/global.css` — body font size + h1/h2/h3 increased
- `src/pages/books.astro` — 2-col grid, font sizes bumped throughout
- `src/pages/join.astro` — added chapter map section with Leaflet.js
- `src/layouts/BaseLayout.astro` — added head slot for page-specific CSS/JS injection

**Decisions:**
- Map uses Leaflet + CartoDB dark_matter tiles — no API key, matches dark CC brand
- Scroll wheel zoom disabled on map (better UX on page scroll)
- Adding new chapters = add entry to chapters array in join.astro script block

**Gotchas:**
- B0-prefix Amazon ASINs use m.media-amazon.com for cover images, not images-na
- BaseLayout needed a head slot to inject Leaflet CSS — now available for all pages

---

## Session — Feb 27, 2026

**Completed:**
- Fixed hero video not playing on deployed site
- Built `/books` page with full CC reading list (11 books, Amazon affiliate links)
- Built newsletter system: admin compose UI + SendGrid send API
- Wrote `SETUP-D1.md` — step-by-step guide to wire up Get Connected form + D1

**Files Changed:**
- `public/_headers` — Accept-Ranges fix for hero video (bg1.mp4, bg2.mp4)
- `src/data/books.json` — 11 CC books, covers from Amazon CDN, all links use tag jbmangum27-20
- `src/pages/books.astro` — Current Read (hero) + The Reading List grid; Field Guide button auto-appears when fieldGuideUrl is set
- `src/components/Header.astro` — added Books to nav
- `src/components/Footer.astro` — added Books to footer nav
- `src/pages/api/newsletter/send.ts` — queries active D1 subscribers, sends branded HTML email via SendGrid, logs to newsletter_sends table; protected by ADMIN_SECRET header
- `src/pages/admin/newsletter.astro` — compose UI with live preview; sections: subject, reading notes, announcements, chapter spotlight
- `data/schema.sql` — added newsletter_sends table
- `.env.example` — added ADMIN_SECRET
- `SETUP-D1.md` — created wire-up guide

**Decisions:**
- All 11 books are CC reads (no separate "recommended" category) — simplified to Current Read + The Reading List
- Amazon affiliate tag: jbmangum27-20 — all buy links formatted as amazon.com/dp/{ASIN}?tag=jbmangum27-20
- Newsletter is manually composed each week — no automation; Brian writes reading notes + announcements + chapter spotlight
- Newsletter admin auth: ADMIN_SECRET env var via x-admin-secret header (no Cloudflare Access needed)
- Field guides: R2 PDFs — fieldGuideUrl starts null, download button appears automatically once URL is set in books.json

**Next Steps:**
- [ ] Brian: run SETUP-D1.md steps to wire up D1 + SendGrid (Get Connected form goes live)
- [ ] Upload field guide PDFs to R2, set fieldGuideUrl in books.json for each
- [ ] Verify all book cover images render (esp. B0CXJJPSVK — newer ASIN format)
- [ ] Refine cc.png into proper vector logo
- [ ] Create OG image (1200×630)

**Gotchas:**
- `_headers` file must live in `public/` — Astro copies it to `dist/`, Cloudflare picks it up from there
- Cloudflare Pages requires Accept-Ranges: bytes for mp4 autoplay — without it browsers silently fail
- Amazon image CDN: `images-na.ssl-images-amazon.com/images/P/{ASIN}.01.L.jpg` works for standard ISBNs; B0-prefix ASINs may need m.media-amazon.com format
- To change current read: set currentRead: true on new book, false on old one in books.json

**Next Steps:**
- [ ] Add SendGrid API key + NOTIFICATION_EMAIL to Cloudflare Pages env vars
- [ ] Test join form end-to-end (D1 insert + email notification)
- [ ] Refine cc.png into proper vector logo
- [ ] Create OG image (1200×630)

---

## Session — Feb 24, 2026

**Completed:**
- Full site redesign: Heraldic Crest + Vintage Badge visual language applied site-wide (4-agent team)
- 6 new CSS utility classes in global.css: `.divider-ornament`, `.label-flanked`, `.badge-frame`, `.rule-heraldic`, `.crest-corners`, `.shield-accent`
- All 4 components updated: Header (double amber line, wide tracking), Footer (flanked tagline), AvatarCard (badge-frame double border), PillarCard (shield-accent border)
- All 4 pages updated: flanked labels, compass dividers, heraldic rules, crest corners on key blocks
- Replaced all inline SVG logos with `cc.png` (Header, Footer, Hero)
- Favicon updated to `cc.png`
- Hero logo sized to 160px, top padding tightened to pull logo closer to header
- Renamed `CC LOGO.png` → `cc.png` (space in filename caused broken image)
- Compass rose SVG embedded as data URI in `.divider-ornament-mark` — every section divider site-wide now shows the compass instead of a diamond

**Files Changed:**
- `src/styles/global.css` — 6 new heraldic utilities + compass divider mark
- `src/components/Header.astro` — cc.png, wider tracking, amber box-shadow
- `src/components/Footer.astro` — cc.png, flanked tagline rules
- `src/components/AvatarCard.astro` — badge-frame, amber rule, heavier number
- `src/components/PillarCard.astro` — shield-accent border, corner accent, em dash
- `src/pages/index.astro` — full heraldic treatment + hero logo + padding
- `src/pages/compass.astro` — heraldic treatment throughout
- `src/pages/about.astro` — heraldic treatment throughout
- `src/pages/join.astro` — heraldic treatment throughout
- `src/components/SEOHead.astro` — favicon updated to cc.png
- `brand/redesign-spec.md` — created by researcher agent
- `public/cc.png` — renamed from CC LOGO.png

**Decisions:**
- All CC content lives in this repo under `brand/` — not AI/ notes folder
- Logo: cc.png used everywhere (header, footer, hero, favicon)
- Divider ornament mark: compass SVG via CSS data URI — scales site-wide from one CSS rule
- CSS data URI approach = zero extra files, infinite reuse across pages

**Next Steps:**
- [ ] Investigate video not playing (check Cloudflare CDN cache, or OS prefers-reduced-motion setting)
- [ ] Refine cc.png logo into proper vector (Figma brief in brand/brand-standards.md)
- [ ] Create OG image (1200×630) using final logo
- [ ] Add SendGrid API key + NOTIFICATION_EMAIL to Cloudflare Pages env vars
- [ ] Test join form end-to-end in production (D1 insert + email notification)

**Gotchas:**
- Dev server (`npx wrangler pages dev dist`) serves compiled dist — always `npm run build` first
- AI/ folder is its own git repo — can't stage from monorepo, use site-crownandcompass repo for all CC content
- Filenames with spaces break as URLs — rename before adding to public/
- CSS data URI SVGs must URL-encode special chars: `#` → `%23`, `<` → `%3C`, `>` → `%3E`, `'` stays as `'`

---

## Session — Feb 21, 2026

**Completed:**
- Replaced white-background `logo.png` with inline SVG compass rose in Header + Footer
- SVG uses `currentColor` → inherits amber accent, no white box on dark bg
- Created `brand/` folder inside repo — all CC brand content lives here now
- `brand/brand-standards.md` — full design reference (logo brief, colors, type, graphic language, asset wishlist, AI image prompts)
- `brand/voice.md` — CC writing voice guide (moved from AI/ notes)
- `brand/logo-mark.svg` — standalone 200×200 SVG for design work
- Identified logo art direction: Heraldic Crest + Vintage Badge hybrid
- Wrote 4 style prompts + 1 final combined prompt for Grok mockups

**Decisions:**
- All CC content (brand, planning, content) lives in this repo, not AI/ notes folder
- Logo style: Heraldic Crest + Vintage Badge hybrid
- Dev server runs on compiled dist — must `npm run build` before previewing changes locally
